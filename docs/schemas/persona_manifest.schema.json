{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://somaagent.ai/schemas/persona_manifest.schema.json",
  "title": "PersonaManifest",
  "description": "Canonical manifest for SomaBrain persona capsules.",
  "type": "object",
  "required": [
    "schema_version",
    "metadata",
    "model_box",
    "memory",
    "tools",
    "governance",
    "pricing",
    "artifacts"
  ],
  "properties": {
    "schema_version": {
      "type": "string",
      "const": "0.2.0"
    },
    "metadata": {
      "$ref": "#/definitions/PersonaMetadata"
    },
    "model_box": {
      "$ref": "#/definitions/ModelBoxReference"
    },
    "memory": {
      "$ref": "#/definitions/MemorySnapshotReference"
    },
    "tools": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/ToolAccessDescriptor"
      }
    },
    "evaluations": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/EvaluationScore"
      },
      "default": []
    },
    "governance": {
      "$ref": "#/definitions/GovernanceMetadata"
    },
    "pricing": {
      "$ref": "#/definitions/PricingModel"
    },
    "artifacts": {
      "$ref": "#/definitions/ArtifactBundle"
    },
    "signature": {
      "$ref": "#/definitions/ManifestSignature"
    }
  },
  "definitions": {
    "PersonaMetadata": {
      "type": "object",
      "required": [
        "persona_id",
        "version",
        "display_name",
        "summary",
        "domains",
        "created_at",
        "updated_at",
        "owners"
      ],
      "properties": {
        "persona_id": { "type": "string" },
        "version": { "type": "string" },
        "display_name": { "type": "string" },
        "summary": { "type": "string" },
        "domains": {
          "type": "array",
          "items": { "type": "string" }
        },
        "created_at": { "type": "string", "format": "date-time" },
        "updated_at": { "type": "string", "format": "date-time" },
        "owners": {
          "type": "array",
          "items": { "$ref": "#/definitions/PersonaOwner" }
        }
      },
      "additionalProperties": false
    },
    "PersonaOwner": {
      "type": "object",
      "required": ["name"],
      "properties": {
        "name": { "type": "string" },
        "contact": { "type": "string" },
        "organization": { "type": "string" }
      },
      "additionalProperties": false
    },
    "ModelBoxReference": {
      "type": "object",
      "required": [
        "model_box_id",
        "version",
        "provider",
        "default_mode",
        "capabilities",
        "temperature"
      ],
      "properties": {
        "model_box_id": { "type": "string" },
        "version": { "type": "string" },
        "provider": { "type": "string" },
        "default_mode": { "type": "string" },
        "capabilities": {
          "type": "array",
          "items": { "$ref": "#/definitions/ModelCapability" }
        },
        "temperature": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 2.0
        }
      },
      "additionalProperties": false
    },
    "ModelCapability": {
      "type": "object",
      "required": ["feature", "enabled"],
      "properties": {
        "feature": { "type": "string" },
        "enabled": { "type": "boolean" },
        "notes": { "type": "string" }
      },
      "additionalProperties": false
    },
    "MemorySnapshotReference": {
      "type": "object",
      "required": [
        "snapshot_id",
        "storage_uri",
        "embedding_model",
        "item_count",
        "checksum"
      ],
      "properties": {
        "snapshot_id": { "type": "string" },
        "storage_uri": { "type": "string", "minLength": 1 },
        "embedding_model": { "type": "string" },
        "item_count": { "type": "integer", "minimum": 0 },
        "checksum": { "type": "string" }
      },
      "additionalProperties": false
    },
    "ToolAccessDescriptor": {
      "type": "object",
      "required": ["tool", "required", "access_scope"],
      "properties": {
        "tool": { "type": "string" },
        "required": { "type": "boolean" },
        "access_scope": { "type": "string" },
        "notes": { "type": "string" }
      },
      "additionalProperties": false
    },
    "EvaluationScore": {
      "type": "object",
      "required": ["benchmark", "score", "captured_at"],
      "properties": {
        "benchmark": { "type": "string" },
        "score": { "type": "number", "minimum": 0.0, "maximum": 1.0 },
        "dataset": { "type": "string" },
        "captured_at": { "type": "string", "format": "date-time" },
        "reference_link": { "type": "string", "format": "uri" },
        "notes": { "type": "string" }
      },
      "additionalProperties": false
    },
    "GovernanceMetadata": {
      "type": "object",
      "required": [
        "constitution_sha",
        "training_snapshot_id",
        "approvals",
        "kill_switch_enabled"
      ],
      "properties": {
        "constitution_sha": { "type": "string" },
        "training_snapshot_id": { "type": "string" },
        "approvals": {
          "type": "array",
          "items": { "type": "string" }
        },
        "kill_switch_enabled": { "type": "boolean" }
      },
      "additionalProperties": false
    },
    "PricingModel": {
      "type": "object",
      "required": ["model", "amount_usd"],
      "properties": {
        "model": { "type": "string" },
        "amount_usd": { "type": "number", "minimum": 0.0 },
        "billing_period_minutes": { "type": "integer", "minimum": 1 },
        "notes": { "type": "string" }
      },
      "additionalProperties": false
    },
    "ArtifactBundle": {
      "type": "object",
      "properties": {
        "prompts_uri": { "type": "string" },
        "evaluation_report_uri": { "type": "string" },
        "release_notes_uri": { "type": "string" }
      },
      "additionalProperties": false
    },
    "ManifestSignature": {
      "type": "object",
      "required": ["algorithm", "signature", "public_key", "digest", "signed_at"],
      "properties": {
        "algorithm": { "type": "string" },
        "signature": { "type": "string" },
        "public_key": { "type": "string" },
        "digest": { "type": "string" },
        "signed_at": { "type": "string", "format": "date-time" }
      },
      "additionalProperties": false
    }
  }
}
